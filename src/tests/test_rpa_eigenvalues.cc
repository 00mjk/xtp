/*
 * Copyright 2009-2019 The VOTCA Development Team (http://www.votca.org)
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */
#define BOOST_TEST_MAIN

#define BOOST_TEST_MODULE rpa_test
#include <boost/test/unit_test.hpp>
#include <votca/xtp/rpa.h>
#include <votca/xtp/aobasis.h>
#include <votca/xtp/orbitals.h>
#include <votca/xtp/threecenter.h>

using namespace std;
using namespace votca::xtp;

BOOST_AUTO_TEST_SUITE(rpa_test)

BOOST_AUTO_TEST_CASE(rpa_eigenvalues) {

  ofstream xyzfile("molecule.xyz");
  xyzfile << " 5" << endl;
  xyzfile << " methane" << endl;
  xyzfile << " C            .000000     .000000     .000000" << endl;
  xyzfile << " H            .629118     .629118     .629118" << endl;
  xyzfile << " H           -.629118    -.629118     .629118" << endl;
  xyzfile << " H            .629118    -.629118    -.629118" << endl;
  xyzfile << " H           -.629118     .629118    -.629118" << endl;
  xyzfile.close();

  ofstream basisfile("3-21G.xml");
  basisfile << "<basis name=\"3-21G\">" << endl;
  basisfile << "  <element name=\"H\">" << endl;
  basisfile << "    <shell scale=\"1.0\" type=\"S\">" << endl;
  basisfile << "      <constant decay=\"5.447178e+00\">" << endl;
  basisfile << "        <contractions factor=\"1.562850e-01\" type=\"S\"/>" << endl;
  basisfile << "      </constant>" << endl;
  basisfile << "      <constant decay=\"8.245470e-01\">" << endl;
  basisfile << "        <contractions factor=\"9.046910e-01\" type=\"S\"/>" << endl;
  basisfile << "      </constant>" << endl;
  basisfile << "    </shell>" << endl;
  basisfile << "    <shell scale=\"1.0\" type=\"S\">" << endl;
  basisfile << "      <constant decay=\"1.831920e-01\">" << endl;
  basisfile << "        <contractions factor=\"1.000000e+00\" type=\"S\"/>" << endl;
  basisfile << "      </constant>" << endl;
  basisfile << "    </shell>" << endl;
  basisfile << "  </element>" << endl;
  basisfile << "  <element name=\"C\">" << endl;
  basisfile << "    <shell scale=\"1.0\" type=\"S\">" << endl;
  basisfile << "      <constant decay=\"1.722560e+02\">" << endl;
  basisfile << "        <contractions factor=\"6.176690e-02\" type=\"S\"/>" << endl;
  basisfile << "      </constant>" << endl;
  basisfile << "      <constant decay=\"2.591090e+01\">" << endl;
  basisfile << "        <contractions factor=\"3.587940e-01\" type=\"S\"/>" << endl;
  basisfile << "      </constant>" << endl;
  basisfile << "      <constant decay=\"5.533350e+00\">" << endl;
  basisfile << "        <contractions factor=\"7.007130e-01\" type=\"S\"/>" << endl;
  basisfile << "      </constant>" << endl;
  basisfile << "    </shell>" << endl;
  basisfile << "    <shell scale=\"1.0\" type=\"SP\">" << endl;
  basisfile << "      <constant decay=\"3.664980e+00\">" << endl;
  basisfile << "        <contractions factor=\"-3.958970e-01\" type=\"S\"/>" << endl;
  basisfile << "        <contractions factor=\"2.364600e-01\" type=\"P\"/>" << endl;
  basisfile << "      </constant>" << endl;
  basisfile << "      <constant decay=\"7.705450e-01\">" << endl;
  basisfile << "        <contractions factor=\"1.215840e+00\" type=\"S\"/>" << endl;
  basisfile << "        <contractions factor=\"8.606190e-01\" type=\"P\"/>" << endl;
  basisfile << "      </constant>" << endl;
  basisfile << "    </shell>" << endl;
  basisfile << "    <shell scale=\"1.0\" type=\"SP\">" << endl;
  basisfile << "      <constant decay=\"1.958570e-01\">" << endl;
  basisfile << "        <contractions factor=\"1.000000e+00\" type=\"S\"/>" << endl;
  basisfile << "        <contractions factor=\"1.000000e+00\" type=\"P\"/>" << endl;
  basisfile << "      </constant>" << endl;
  basisfile << "    </shell>" << endl;
  basisfile << "  </element>" << endl;
  basisfile << "</basis>" << endl;
  basisfile.close();

  Orbitals orbitals;
  orbitals.LoadFromXYZ("molecule.xyz");
  BasisSet basis;
  basis.LoadBasisSet("3-21G.xml");

  AOBasis aobasis;
  aobasis.AOBasisFill(basis, orbitals.QMAtoms());

  Eigen::VectorXd eigenvals = Eigen::VectorXd::Zero(17);
  eigenvals << 0.0468207, 0.0907801, 0.0907801, 0.104563, 0.592491, 0.663355,
          0.663355, 0.768373, 1.69292, 1.97724, 1.97724, 2.50877, 2.98732, 3.4418, 3.4418, 4.81084,
          17.1838;

  Eigen::MatrixXd eigenvectors = Eigen::MatrixXd::Zero(17, 17);
  eigenvectors << 0.0185815, 2.9133e-17, 8.49354e-17, -0.00312916, 0.0420075, 1.11356e-16, 1.85886e-17, -0.0334732, 0.0485113, -8.71556e-18, -3.79994e-17, -0.0346485, -0.0248392, -3.32286e-22, -4.62643e-17, 0.0144472, 0.996183,
          0.166534, 2.80578e-16, 7.85515e-16, -0.0299557, 0.409156, 1.10045e-15, 1.67666e-16, -0.336895, 0.608646, -1.00343e-16, -5.04622e-16, -0.437568, -0.299751, -2.77682e-17, -6.06812e-16, 0.176594, -0.0866677,
          0.0010572, -0.0210402, -0.0345975, 0.035778, 0.0611836, 0.0374747, -0.154443, 0.0892921, 0.0842611, -0.35309, -0.0759572, 0.278374, -0.409082, -0.64367, 0.308248, -0.261525, -0.000315534,
          -0.0010572, -0.0404824, 0.000922593, -0.035778, -0.0611836, -0.115015, -0.109676, -0.0892921, -0.0842611, -0.242326, 0.267806, -0.278374, 0.409082, -0.0548848, 0.711558, 0.261525, 0.000315534,
          0.0010572, -0.0194422, 0.0355201, 0.035778, 0.0611836, -0.152489, 0.0447677, 0.0892921, 0.0842611, 0.110764, 0.343764, 0.278374, -0.409082, 0.588785, 0.403311, -0.261525, -0.000315534,
          -0.823783, -9.8891e-16, -3.34692e-15, 0.103497, -0.277613, -5.51463e-16, 4.95594e-17, 0.163544, 0.121215, -7.23985e-17, -2.63149e-16, -0.259891, -0.284396, -1.74149e-16, -6.65818e-16, 0.208987, 0.00782842,
          -0.0333718, 0.22696, 0.373203, -0.337332, -0.251625, -0.144131, 0.594004, -0.329076, -0.0456626, 0.18588, 0.0399869, -0.0631275, -0.0704844, -0.231899, 0.111054, -0.189161, 0.000129868,
          0.0333718, 0.436683, -0.009952, 0.337332, 0.251625, 0.442357, 0.421824, 0.329076, 0.0456626, 0.12757, -0.140984, 0.0631275, 0.0704844, -0.0197737, 0.256357, 0.189161, -0.000129868,
          -0.0333718, 0.209723, -0.383155, -0.337332, -0.251625, 0.586489, -0.172181, -0.329076, -0.0456626, -0.0583106, -0.180971, -0.0631275, -0.0704844, 0.212125, 0.145303, -0.189161, 0.000129868,
          -0.00177478, 0.0553645, -0.00126176, -0.0164247, 0.23154, -0.262519, -0.250334, -0.0135392, -0.429472, 0.45567, -0.503583, -0.223493, -0.211802, -0.020461, 0.265268, 0.0023362, -0.00241145,
          0.294363, -0.686239, 0.0156394, 0.204055, -0.360136, 0.267096, 0.254698, 0.074687, -0.0228668, 0.132236, -0.14614, -0.174986, -0.185046, -0.0109958, 0.142556, 0.0661743, 0.0022999,
          -0.00177478, -0.0265895, 0.0485779, -0.0164247, 0.23154, 0.348055, -0.102182, -0.0135392, -0.429472, 0.208281, 0.646413, -0.223493, -0.211802, -0.219498, -0.150354, 0.0023362, -0.00241145,
          0.294363, 0.329576, -0.60212, 0.204055, -0.360136, -0.354123, 0.103963, 0.074687, -0.0228668, 0.0604434, 0.18759, -0.174986, -0.185046, -0.117959, -0.0808008, 0.0661743, 0.0022999,
          -0.00177478, -0.028775, -0.0473162, -0.0164247, 0.23154, -0.0855356, 0.352515, -0.0135392, -0.429472, -0.663951, -0.14283, -0.223493, -0.211802, 0.239959, -0.114914, 0.0023362, -0.00241145,
          0.294363, 0.356664, 0.586481, 0.204055, -0.360136, 0.0870267, -0.358661, 0.074687, -0.0228668, -0.192679, -0.0414494, -0.174986, -0.185046, 0.128955, -0.0617554, 0.0661743, 0.0022999,
          0.00741062, -3.87173e-16, -4.31863e-16, 0.0468488, -0.0476991, 7.27357e-16, 1.23654e-15, -0.43422, -0.159247, -4.34945e-17, 1.2743e-16, 0.503528, -0.228856, -7.97629e-17, -2.53026e-16, 0.689669, -0.00301027,
          0.173046, 7.91486e-15, 8.39419e-15, -0.717804, -0.0195249, -1.10754e-15, -1.66789e-15, 0.551371, 0.0684292, 4.15572e-17, -1.84233e-16, 0.0105378, -0.148396, -1.63792e-16, -4.6499e-16, 0.351571, 0.00210309;

  TCMatrix_gwbse Mmn;
  Mmn.Initialize(aobasis.AOBasisSize(), 0, 16, 0, 16);
  Mmn.Fill(aobasis, aobasis, eigenvectors);

  votca::ctp::Logger log;
  RPA rpa(log, Mmn);
  rpa.setRPAInputEnergies(eigenvals);
  rpa.configure(4, 0, 16);

  rpa_eigensolution sol = rpa.calculate_eigenvalues();

  Eigen::VectorXd rpa_eigenvalues_ref = Eigen::VectorXd(60);
  rpa_eigenvalues_ref << 0.0409585, 0.0409585, 0.168632, 0.558112, 0.558112, 0.569209,
          0.569213, 0.571139, 0.571143, 0.615648, 0.615648, 0.660461,
          0.677119, 0.677119, 0.720886, 1.09061, 1.36864, 1.36864,
          1.58815, 1.60134, 1.60134, 1.64505, 1.7298, 1.87221,
          1.87221, 1.87924, 1.87924, 1.88489, 1.88489, 1.92932,
          1.92932, 2.21999, 2.40103, 2.41599, 2.41599, 2.46084,
          2.83022, 2.83022, 2.87894, 2.89419, 2.89419, 2.93891,
          3.33663, 3.33663, 3.34833, 3.34833, 3.34982, 3.34982,
          3.39441, 3.39441, 4.21335, 4.70138, 4.71893, 4.71893,
          4.76327, 16.5911, 17.0792, 17.093, 17.093, 17.1366;

  Eigen::MatrixXd rpa_XpY_ref = Eigen::MatrixXd(60, 60);
  rpa_XpY_ref << 0, 0, 0, 0, 0, 0, 0, 0, 0, -0.849941, -0.528241, 0, 0, 0, 1.64136e-09, 0, 0, 0, 0, 0, 0, 1.44997e-11, 0, 0, 0, 0, 0, 0, 0, 0.000335454, 6.43746e-05, 0, 0, 0, 0, 4.24805e-12, 0, 0, 0, 0, 0, -1.6812e-11, 0, 0, 0, 0, 0, 0, -4.97798e-05, 3.83077e-05, 0, 0, 0, 0, -1.49231e-11, 0, 0, 0, 0, 3.43503e-14,
          0, 0, 0, 0, 0, 0, 0, 0, 0, -0.528241, 0.849941, 0, 0, 0, 1.19022e-09, 0, 0, 0, 0, 0, 0, 3.2481e-10, 0, 0, 0, 0, 0, 0, 0, -6.43744e-05, 0.000335454, 0, 0, 0, 0, -1.50268e-10, 0, 0, 0, 0, 0, 9.70958e-11, 0, 0, 0, 0, 0, 0, -3.83077e-05, -4.97797e-05, 0, 0, 0, 0, -4.93495e-12, 0, 0, 0, 0, 2.25466e-13,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 2.36714e-09, -1.6904e-10, 0, 0, 0, 1.00046, 0, 0, 0, 0, 0, 0, -0.00030433, 0, 0, 0, 0, 0, 0, 0, -1.87972e-10, 9.21571e-11, 0, 0, 0, 0, 6.50719e-05, 0, 0, 0, 0, 0, -9.2318e-05, 0, 0, 0, 0, 0, 0, 1.71446e-11, 1.97935e-11, 0, 0, 0, 0, 3.35638e-05, 0, 0, 0, 0, -4.69863e-07,
          0, 0, 0, 0, 0, 0, 0, 0, 0, -4.91154e-10, 7.17921e-10, 0, 0, 0, -0.000694116, 0, 0, 0, 0, 0, 0, -1.00032, 0, 0, 0, 0, 0, 0, 0, 1.91867e-09, -6.04132e-10, 0, 0, 0, 0, -0.000576844, 0, 0, 0, 0, 0, 0.000336724, 0, 0, 0, 0, 0, 0, -9.73647e-11, -6.51238e-11, 0, 0, 0, 0, -2.29986e-05, 0, 0, 0, 0, 2.92423e-06,
          0, 0, 0, 0, 0, 0, 0, 0, 0, -0.000540786, 0.000923121, 0, 0, 0, 3.50386e-10, 0, 0, 0, 0, 0, 0, 1.17343e-09, 0, 0, 0, 0, 0, 0, 0, 0.214139, -0.977096, 0, 0, 0, 0, 5.39737e-10, 0, 0, 0, 0, 0, -3.11167e-10, 0, 0, 0, 0, 0, 0, -0.000174118, -0.000238936, 0, 0, 0, 0, 5.46433e-11, 0, 0, 0, 0, -3.22923e-13,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 0.000923122, 0.000540786, 0, 0, 0, 4.3766e-10, 0, 0, 0, 0, 0, 0, 2.04481e-09, 0, 0, 0, 0, 0, 0, 0, 0.977096, 0.214139, 0, 0, 0, 0, 1.04104e-09, 0, 0, 0, 0, 0, -6.84538e-10, 0, 0, 0, 0, 0, 0, 0.000238936, -0.000174118, 0, 0, 0, 0, 4.74502e-11, 0, 0, 0, 0, -4.55745e-13,
          0, 0, 0, 0, 0, 0, 0, 0, 0, -3.03813e-10, 5.17161e-10, 0, 0, 0, -0.000221843, 0, 0, 0, 0, 0, 0, -0.000861455, 0, 0, 0, 0, 0, 0, 0, -1.44026e-09, 3.87468e-10, 0, 0, 0, 0, 1.00022, 0, 0, 0, 0, 0, 0.00214367, 0, 0, 0, 0, 0, 0, -2.44267e-10, -1.61999e-10, 0, 0, 0, 0, -0.000117753, 0, 0, 0, 0, -1.53889e-06,
          0, 0, 0, 0, 0, 0, 0, 0, 0, -1.78979e-10, 4.36525e-10, 0, 0, 0, -0.000377228, 0, 0, 0, 0, 0, 0, -0.00060361, 0, 0, 0, 0, 0, 0, 0, -1.12256e-09, 2.40736e-10, 0, 0, 0, 0, 0.00255982, 0, 0, 0, 0, 0, -1.00027, 0, 0, 0, 0, 0, 0, -2.94532e-10, -3.65599e-10, 0, 0, 0, 0, -0.000216988, 0, 0, 0, 0, -1.957e-06,
          0, 0, 0, 0, 0, 0, 0, 0, 0, -4.44508e-05, -0.000343799, 0, 0, 0, 9.08343e-11, 0, 0, 0, 0, 0, 0, 1.27694e-10, 0, 0, 0, 0, 0, 0, 0, -0.000398825, 0.000333572, 0, 0, 0, 0, -2.15108e-10, 0, 0, 0, 0, 0, 4.12e-10, 0, 0, 0, 0, 0, 0, 0.0287663, -0.99967, 0, 0, 0, 0, 9.22748e-11, 0, 0, 0, 0, -3.55744e-13,
          0, 0, 0, 0, 0, 0, 0, 0, 0, -0.000343799, 4.44508e-05, 0, 0, 0, -8.30389e-11, 0, 0, 0, 0, 0, 0, -2.05505e-10, 0, 0, 0, 0, 0, 0, 0, -0.000333573, -0.000398825, 0, 0, 0, 0, 3.43637e-10, 0, 0, 0, 0, 0, -3.51069e-10, 0, 0, 0, 0, 0, 0, 0.99967, 0.0287663, 0, 0, 0, 0, -1.12256e-10, 0, 0, 0, 0, 6.88188e-13,
          0, 0, 0, 0, 0, 0, 0, 0, 0, 1.18915e-10, 2.82791e-11, 0, 0, 0, 0.000221918, 0, 0, 0, 0, 0, 0, 6.69179e-05, 0, 0, 0, 0, 0, 0, 0, 1.43803e-10, -1.06706e-10, 0, 0, 0, 0, -0.00022874, 0, 0, 0, 0, 0, 0.000351086, 0, 0, 0, 0, 0, 0, -1.53553e-10, -1.33844e-10, 0, 0, 0, 0, -1.00008, 0, 0, 0, 0, 2.97813e-06,
          0, 0, 0, 0, 0, 0, 0, 0, 0, -4.1599e-12, 4.83175e-12, 0, 0, 0, -1.11764e-05, 0, 0, 0, 0, 0, 0, -3.04323e-05, 0, 0, 0, 0, 0, 0, 0, -4.47726e-12, 1.90734e-12, 0, 0, 0, 0, -1.0764e-05, 0, 0, 0, 0, 0, 1.14003e-05, 0, 0, 0, 0, 0, 0, 3.42153e-12, 1.89839e-12, 0, 0, 0, 0, -1.07109e-05, 0, 0, 0, 0, -1.00001,
          0, 0, 0, 0, 0, 0.709984, 0, 0, 0.707196, 0, 0, 0, 0.00225696, 0, 0, 0, 0, 0, 0, 0.000364626, 0, 0, 0, 0, 0, -0.00100579, 0, 0, -0.000354073, 0, 0, 0, 0, -0.000159965, 0, 0, 0, 0, 0, 0.000115333, 0, 0, 0, 0, 0, 0.000212074, 9.37774e-05, 0, 0, 0, 0, 0, 0, -1.77612e-05, 0, 0, 0, 1.15731e-07, 0, 0,
          0, 0, 0, 0, 0, 0.70839, 0, 0, -0.708788, 0, 0, 0, 0.00196015, 0, 0, 0, 0, 0, 0, 0.000317791, 0, 0, 0, 0, 0, -0.00100377, 0, 0, 0.000354773, 0, 0, 0, 0, -0.000139104, 0, 0, 0, 0, 0, 0.000100355, 0, 0, 0, 0, 0, 0.00021171, -9.39448e-05, 0, 0, 0, 0, 0, 0, -1.54517e-05, 0, 0, 0, 1.007e-07, 0, 0,
          0, 0, 0, 0, 0, -0.00353795, 0, 0, -0.000244612, 0, 0, 0, 1.00034, 0, 0, 0, 0, 0, 0, -4.48827e-05, 0, 0, 0, 0, 0, 8.48844e-05, 0, 0, 5.74883e-06, 0, 0, 0, 0, -0.000102132, 0, 0, 0, 0, 0, 8.07261e-05, 0, 0, 0, 0, 0, -4.80133e-05, -3.29044e-06, 0, 0, 0, 0, 0, 0, 4.43102e-05, 0, 0, 0, -1.11395e-07, 0, 0,
          0, 0, 0, 0, 0, -0.00133545, 0, 0, -9.07558e-05, 0, 0, 0, 0.000101792, 0, 0, 0, 0, 0, 0, 1.00024, 0, 0, 0, 0, 0, 0.00362056, 0, 0, 0.000241914, 0, 0, 0, 0, 0.00101326, 0, 0, 0, 0, 0, -0.000616338, 0, 0, 0, 0, 0, -0.000318871, -2.18661e-05, 0, 0, 0, 0, 0, 0, 5.75697e-06, 0, 0, 0, -2.23336e-07, 0, 0,
          0, 0, 0, 0, 0, 0.0032228, 0, 0, -0.00119986, 0, 0, 0, -0.0001421, 0, 0, 0, 0, 0, 0, -0.00271454, 0, 0, 0, 0, 0, 0.688955, 0, 0, -0.726346, 0, 0, 0, 0, -0.00145353, 0, 0, 0, 0, 0, 0.000734142, 0, 0, 0, 0, 0, 0.00112999, -0.000455155, 0, 0, 0, 0, 0, 0, -2.24015e-05, 0, 0, 0, 1.92872e-07, 0, 0,
          0, 0, 0, 0, 0, -0.00340343, 0, 0, -0.00113599, 0, 0, 0, 0.000172961, 0, 0, 0, 0, 0, 0, 0.00327968, 0, 0, 0, 0, 0, -0.727424, 0, 0, -0.687932, 0, 0, 0, 0, 0.00176343, 0, 0, 0, 0, 0, -0.000889878, 0, 0, 0, 0, 0, -0.00119272, -0.000431157, 0, 0, 0, 0, 0, 0, 2.71665e-05, 0, 0, 0, -2.33737e-07, 0, 0,
          0, 0, 0, 0, 0, -0.000905387, 0, 0, -6.14684e-05, 0, 0, 0, -0.00036497, 0, 0, 0, 0, 0, 0, 0.00153593, 0, 0, 0, 0, 0, -0.00291046, 0, 0, -0.000200665, 0, 0, 0, 0, -1.0004, 0, 0, 0, 0, 0, -0.00410703, 0, 0, 0, 0, 0, -0.000722383, -4.95285e-05, 0, 0, 0, 0, 0, 0, -0.00022339, 0, 0, 0, 3.59121e-07, 0, 0,
          0, 0, 0, 0, 0, -0.000783496, 0, 0, -5.31829e-05, 0, 0, 0, -0.000348966, 0, 0, 0, 0, 0, 0, 0.00112765, 0, 0, 0, 0, 0, -0.00177391, 0, 0, -0.000121711, 0, 0, 0, 0, -0.00491258, 0, 0, 0, 0, 0, 1.00039, 0, 0, 0, 0, 0, -0.00177491, -0.000121488, 0, 0, 0, 0, 0, 0, -0.000354326, 0, 0, 0, 2.29038e-07, 0, 0,
          0, 0, 0, 0, 0, -0.000176615, 0, 0, 0.000775692, 0, 0, 0, 7.12986e-06, 0, 0, 0, 0, 0, 0, 2.1958e-05, 0, 0, 0, 0, 0, -0.000291213, 0, 0, 0.00110804, 0, 0, 0, 0, -3.12903e-05, 0, 0, 0, 0, 0, 6.44479e-05, 0, 0, 0, 0, 0, 0.0997422, -0.995195, 0, 0, 0, 0, 0, 0, 1.01313e-05, 0, 0, 0, -3.89256e-08, 0, 0,
          0, 0, 0, 0, 0, 0.00176729, 0, 0, 7.75423e-05, 0, 0, 0, -0.000232193, 0, 0, 0, 0, 0, 0, -0.000683441, 0, 0, 0, 0, 0, 0.00291001, 0, 0, 0.000110866, 0, 0, 0, 0, 0.00100557, 0, 0, 0, 0, 0, -0.00204924, 0, 0, 0, 0, 0, -0.995411, -0.0997203, 0, 0, 0, 0, 0, 0, -0.000323209, 0, 0, 0, 1.23908e-06, 0, 0,
          0, 0, 0, 0, 0, -0.000195648, 0, 0, -1.33131e-05, 0, 0, 0, 0.000308639, 0, 0, 0, 0, 0, 0, 1.62207e-05, 0, 0, 0, 0, 0, -8.67234e-05, 0, 0, -5.91223e-06, 0, 0, 0, 0, 0.000438798, 0, 0, 0, 0, 0, -0.000574942, 0, 0, 0, 0, 0, 0.000455651, 3.12772e-05, 0, 0, 0, 0, 0, 0, -1.00012, 0, 0, 0, -1.94723e-06, 0, 0,
          0, 0, 0, 0, 0, 4.61767e-06, 0, 0, 3.13942e-07, 0, 0, 0, -2.80323e-06, 0, 0, 0, 0, 0, 0, -2.39167e-06, 0, 0, 0, 0, 0, 2.73852e-06, 0, 0, 1.86691e-07, 0, 0, 0, 0, -2.55242e-06, 0, 0, 0, 0, 0, 1.3379e-06, 0, 0, 0, 0, 0, -6.31181e-06, -4.32956e-07, 0, 0, 0, 0, 0, 0, 7.04903e-06, 0, 0, 0, -1, 0, 0,
          0, 0, 0, 0, 0, 0, 0.708608, 0.70857, 0, 0, 0, 0, 0, 0.00228407, 0, 0, 0, 0, 0, 0, 0.000360864, 0, 0, 0, 0, 0, -0.00100346, 0.000355168, 0, 0, 0, 0, 0, 0, -0.000160594, 0, 0, 0, 0, 0, 0.000115329, 0, 0, 0, 0.000211865, 0, 0, 9.37553e-05, 0, 0, 0, 0, -1.77838e-05, 0, 0, 0, 0, 0, 1.15739e-07, 0,
          0, 0, 0, 0, 0, 0, -0.70977, 0.707412, 0, 0, 0, 0, 0, 0.00199118, 0, 0, 0, 0, 0, 0, 0.000313487, 0, 0, 0, 0, 0, 0.00100533, 0.000354492, 0, 0, 0, 0, 0, 0, -0.000139827, 0, 0, 0, 0, 0, 0.000100353, 0, 0, 0, -0.000212325, 0, 0, 9.35581e-05, 0, 0, 0, 0, -1.54774e-05, 0, 0, 0, 0, 0, 1.00711e-07, 0,
          0, 0, 0, 0, 0, 0, 0.000242761, 0.00358089, 0, 0, 0, 0, 0, -1.00034, 0, 0, 0, 0, 0, 0, 4.48719e-05, 0, 0, 0, 0, 0, -5.81472e-06, 8.40107e-05, 0, 0, 0, 0, 0, 0, 0.000102133, 0, 0, 0, 0, 0, -8.07269e-05, 0, 0, 0, 3.28215e-06, 0, 0, 4.79919e-05, 0, 0, 0, 0, -4.43105e-05, 0, 0, 0, 0, 0, 1.11395e-07, 0,
          0, 0, 0, 0, 0, 0, 9.16273e-05, 0.00132856, 0, 0, 0, 0, 0, -0.000101751, 0, 0, 0, 0, 0, 0, -1.00024, 0, 0, 0, 0, 0, -0.000247985, 0.00353517, 0, 0, 0, 0, 0, 0, -0.00101323, 0, 0, 0, 0, 0, 0.00061633, 0, 0, 0, 2.17969e-05, 0, 0, 0.000318907, 0, 0, 0, 0, -5.75739e-06, 0, 0, 0, 0, 0, 2.23337e-07, 0,
          0, 0, 0, 0, 0, 0, -0.00339867, 0.00114014, 0, 0, 0, 0, 0, -0.00014733, 0, 0, 0, 0, 0, 0, -0.0026467, 0, 0, 0, 0, 0, -0.727388, -0.687974, 0, 0, 0, 0, 0, 0, -0.00146734, 0, 0, 0, 0, 0, 0.000735688, 0, 0, 0, -0.00119437, 0, 0, 0.000429786, 0, 0, 0, 0, -2.25371e-05, 0, 0, 0, 0, 0, 1.92943e-07, 0,
          0, 0, 0, 0, 0, 0, -0.00321999, -0.00120322, 0, 0, 0, 0, 0, 0.000177779, 0, 0, 0, 0, 0, 0, 0.0032172, 0, 0, 0, 0, 0, -0.68901, 0.726292, 0, 0, 0, 0, 0, 0, 0.00177613, 0, 0, 0, 0, 0, -0.000891284, 0, 0, 0, -0.001131, 0, 0, -0.00045381, 0, 0, 0, 0, 2.72926e-05, 0, 0, 0, 0, 0, -2.33791e-07, 0,
          0, 0, 0, 0, 0, 0, 6.21179e-05, 0.000899802, 0, 0, 0, 0, 0, 0.000365, 0, 0, 0, 0, 0, 0, -0.00153573, 0, 0, 0, 0, 0, 0.000199334, -0.00293231, 0, 0, 0, 0, 0, 0, 1.0004, 0, 0, 0, 0, 0, 0.004107, 0, 0, 0, 4.93784e-05, 0, 0, 0.000722319, 0, 0, 0, 0, 0.000223391, 0, 0, 0, 0, 0, -3.59129e-07, 0,
          0, 0, 0, 0, 0, 0, 5.37544e-05, 0.000778513, 0, 0, 0, 0, 0, 0.000348992, 0, 0, 0, 0, 0, 0, -0.0011275, 0, 0, 0, 0, 0, 0.00012149, -0.00177857, 0, 0, 0, 0, 0, 0, 0.0049125, 0, 0, 0, 0, 0, -1.00039, 0, 0, 0, 0.000121322, 0, 0, 0.00177176, 0, 0, 0, 0, 0.000354328, 0, 0, 0, 0, 0, -2.29048e-07, 0,
          0, 0, 0, 0, 0, 0, 0.00176478, -7.7992e-05, 0, 0, 0, 0, 0, 7.53755e-06, 0, 0, 0, 0, 0, 0, 2.0771e-05, 0, 0, 0, 0, 0, 0.00290932, 0.000111036, 0, 0, 0, 0, 0, 0, -3.20385e-05, 0, 0, 0, 0, 0, 6.43009e-05, 0, 0, 0, -0.995434, 0, 0, 0.0995155, 0, 0, 0, 0, 1.0192e-05, 0, 0, 0, 0, 0, -3.89472e-08, 0,
          0, 0, 0, 0, 0, 0, 0.000176939, 0.000778116, 0, 0, 0, 0, 0, -0.000234597, 0, 0, 0, 0, 0, 0, -0.00067643, 0, 0, 0, 0, 0, 0.0002913, -0.00110876, 0, 0, 0, 0, 0, 0, 0.00100993, 0, 0, 0, 0, 0, -0.00204825, 0, 0, 0, -0.0995373, 0, 0, -0.995213, 0, 0, 0, 0, -0.00032357, 0, 0, 0, 0, 0, 1.23916e-06, 0,
          0, 0, 0, 0, 0, 0, 1.34244e-05, 0.000194901, 0, 0, 0, 0, 0, -0.000308634, 0, 0, 0, 0, 0, 0, -1.6214e-05, 0, 0, 0, 0, 0, 5.94244e-06, -8.63994e-05, 0, 0, 0, 0, 0, 0, -0.000438801, 0, 0, 0, 0, 0, 0.000574947, 0, 0, 0, -3.11477e-05, 0, 0, -0.000456193, 0, 0, 0, 0, 1.00012, 0, 0, 0, 0, 0, 1.94725e-06, 0,
          0, 0, 0, 0, 0, 0, -3.16823e-07, -4.5958e-06, 0, 0, 0, 0, 0, 2.80309e-06, 0, 0, 0, 0, 0, 0, 2.39142e-06, 0, 0, 0, 0, 0, -1.87502e-07, 2.72812e-06, 0, 0, 0, 0, 0, 0, 2.55251e-06, 0, 0, 0, 0, 0, -1.33797e-06, 0, 0, 0, 4.31443e-07, 0, 0, 6.31452e-06, 0, 0, 0, 0, -7.04907e-06, 0, 0, 0, 0, 0, 1, 0,
          0, 0, 0, 0.88387, 0.469033, 0, 0, 0, 0, 0, 0, 1.82348e-08, 0, 0, 0, 0, 0, 0, 1.06809e-10, 0, 0, 0, 0, 0.000183481, 7.96855e-06, 0, 0, 0, 0, 0, 0, 0, 2.64442e-11, 0, 0, 0, 0, 0, -2.18162e-10, 0, 0, 0, -1.41267e-06, 6.41487e-05, 0, 0, 0, 0, 0, 0, 0, -1.14196e-10, 0, 0, 0, 0, 2.90448e-13, 0, 0, 0,
          0, 0, 0, 0.469033, -0.88387, 0, 0, 0, 0, 0, 0, -1.34659e-08, 0, 0, 0, 0, 0, 0, 9.65453e-11, 0, 0, 0, 0, 7.96863e-06, -0.000183481, 0, 0, 0, 0, 0, 0, 0, 2.94096e-10, 0, 0, 0, 0, 0, 1.45634e-10, 0, 0, 0, 6.41487e-05, 1.41268e-06, 0, 0, 0, 0, 0, 0, 0, 8.11268e-11, 0, 0, 0, 0, -1.92065e-13, 0, 0, 0,
          0, 0, 0, -1.1614e-08, -2.4237e-08, 0, 0, 0, 0, 0, 0, 1.00253, 0, 0, 0, 0, 0, 0, 5.74784e-05, 0, 0, 0, 0, 4.74752e-11, -4.65997e-10, 0, 0, 0, 0, 0, 0, 0, 0.000207091, 0, 0, 0, 0, 0, -4.4091e-05, 0, 0, 0, -8.84832e-11, 1.05432e-11, 0, 0, 0, 0, 0, 0, 0, 0.000239611, 0, 0, 0, 0, -2.13064e-07, 0, 0, 0,
          0, 0, 0, 3.95088e-10, -1.03223e-10, 0, 0, 0, 0, 0, 0, 0.000137423, 0, 0, 0, 0, 0, 0, -1.00007, 0, 0, 0, 0, 1.23538e-10, 4.95738e-10, 0, 0, 0, 0, 0, 0, 0, 0.000536932, 0, 0, 0, 0, 0, -4.66866e-05, 0, 0, 0, 8.17361e-11, 3.93593e-11, 0, 0, 0, 0, 0, 0, 0, 2.20045e-05, 0, 0, 0, 0, 2.02173e-07, 0, 0, 0,
          0, 0, 0, 0.000274283, -0.000551217, 0, 0, 0, 0, 0, 0, 1.31148e-09, 0, 0, 0, 0, 0, 0, 5.81427e-10, 0, 0, 0, 0, -0.0172535, 0.999977, 0, 0, 0, 0, 0, 0, 0, -7.33701e-10, 0, 0, 0, 0, 0, 9.1477e-11, 0, 0, 0, 0.000226096, -9.34308e-07, 0, 0, 0, 0, 0, 0, 0, 2.57598e-10, 0, 0, 0, 0, -2.10818e-13, 0, 0, 0,
          0, 0, 0, -0.000551217, -0.000274283, 0, 0, 0, 0, 0, 0, -1.21979e-10, 0, 0, 0, 0, 0, 0, 1.54859e-10, 0, 0, 0, 0, 0.999977, 0.0172535, 0, 0, 0, 0, 0, 0, 0, -1.052e-09, 0, 0, 0, 0, 0, -1.18205e-09, 0, 0, 0, -9.34348e-07, -0.000226096, 0, 0, 0, 0, 0, 0, 0, 1.86717e-11, 0, 0, 0, 0, 6.57337e-13, 0, 0, 0,
          0, 0, 0, 6.86737e-10, -1.07913e-09, 0, 0, 0, 0, 0, 0, 0.00075153, 0, 0, 0, 0, 0, 0, -0.000812334, 0, 0, 0, 0, -1.32979e-09, -9.6537e-10, 0, 0, 0, 0, 0, 0, 0, -1.00066, 0, 0, 0, 0, 0, 0.00182162, 0, 0, 0, 6.51005e-10, 3.82648e-10, 0, 0, 0, 0, 0, 0, 0, 0.000223433, 0, 0, 0, 0, -9.23217e-07, 0, 0, 0,
          0, 0, 0, -6.3703e-10, -1.18913e-09, 0, 0, 0, 0, 0, 0, -0.000189573, 0, 0, 0, 0, 0, 0, 8.2874e-05, 0, 0, 0, 0, -1.82418e-09, 1.07818e-10, 0, 0, 0, 0, 0, 0, 0, -0.00218446, 0, 0, 0, 0, 0, -1.00066, 0, 0, 0, -1.09663e-09, -6.29831e-10, 0, 0, 0, 0, 0, 0, 0, -0.000371367, 0, 0, 0, 0, -2.75356e-06, 0, 0, 0,
          0, 0, 0, 7.50115e-05, 0.000376246, 0, 0, 0, 0, 0, 0, 3.91128e-10, 0, 0, 0, 0, 0, 0, 8.46947e-11, 0, 0, 0, 0, -0.000240996, -0.000322834, 0, 0, 0, 0, 0, 0, 0, 3.85294e-10, 0, 0, 0, 0, 0, -5.53417e-10, 0, 0, 0, 0.788441, -0.615258, 0, 0, 0, 0, 0, 0, 0, 4.32063e-10, 0, 0, 0, 0, -3.61965e-13, 0, 0, 0,
          0, 0, 0, 0.000376246, -7.50115e-05, 0, 0, 0, 0, 0, 0, -2.28492e-10, 0, 0, 0, 0, 0, 0, -1.71626e-10, 0, 0, 0, 0, -0.000322834, 0.000240996, 0, 0, 0, 0, 0, 0, 0, -9.72092e-10, 0, 0, 0, 0, 0, 1.35891e-09, 0, 0, 0, -0.615258, -0.788441, 0, 0, 0, 0, 0, 0, 0, -2.51246e-10, 0, 0, 0, 0, 6.2323e-13, 0, 0, 0,
          0, 0, 0, -5.48284e-10, -1.0955e-09, 0, 0, 0, 0, 0, 0, 0.00170266, 0, 0, 0, 0, 0, 0, -6.54771e-05, 0, 0, 0, 0, 3.61445e-11, 6.46173e-10, 0, 0, 0, 0, 0, 0, 0, -0.000435725, 0, 0, 0, 0, 0, 0.000607083, 0, 0, 0, 6.99032e-10, -9.49787e-11, 0, 0, 0, 0, 0, 0, 0, -1.00052, 0, 0, 0, 0, -4.75454e-07, 0, 0, 0,
          0, 0, 0, -5.16141e-12, -9.5114e-12, 0, 0, 0, 0, 0, 0, 5.5003e-06, 0, 0, 0, 0, 0, 0, 2.17029e-06, 0, 0, 0, 0, -6.06752e-12, 1.80963e-12, 0, 0, 0, 0, 0, 0, 0, -6.59918e-06, 0, 0, 0, 0, 0, -1.63117e-05, 0, 0, 0, 3.41069e-12, 1.36787e-12, 0, 0, 0, 0, 0, 0, 0, -1.72966e-06, 0, 0, 0, 0, 1, 0, 0, 0,
          -1.17211, -0.596855, -6.9305e-08, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2.13177e-09, 0.00137159, -9.89272e-05, 0, 0, 0, 0, -4.40015e-09, 0, 0, 0, 0, 0, 0, 0, 0, -1.74524e-09, 0, 0, 0, 0, -1.14322e-05, -0.000358832, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -9.55564e-12, 0, 0, 0, 0, 1.07768e-13, 0, 0, 0, 0,
          -0.596855, 1.17211, 7.64755e-08, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -3.56112e-09, 9.89277e-05, 0.00137159, 0, 0, 0, 0, 6.02849e-09, 0, 0, 0, 0, 0, 0, 0, 0, 2.39122e-09, 0, 0, 0, 0, -0.000358832, 1.14321e-05, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -2.20456e-11, 0, 0, 0, 0, 4.89596e-14, 0, 0, 0, 0,
          8.64811e-08, 3.17762e-07, -1.02124, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -0.00105855, 2.61883e-09, 2.39039e-10, 0, 0, 0, 0, 0.00190022, 0, 0, 0, 0, 0, 0, 0, 0, 0.000873431, 0, 0, 0, 0, 1.00274e-10, -5.95504e-12, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 8.44721e-05, 0, 0, 0, 0, -2.40245e-07, 0, 0, 0, 0,
          7.27128e-09, 7.47861e-08, -0.00566279, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1.00253, 1.02058e-07, -1.40124e-08, 0, 0, 0, 0, 0.0470912, 0, 0, 0, 0, 0, 0, 0, 0, 0.0141768, 0, 0, 0, 0, -2.44071e-10, -1.71102e-10, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -0.000270547, 0, 0, 0, 0, 1.39151e-06, 0, 0, 0, 0,
          -0.0150592, 0.0315898, -1.21771e-09, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1.00057e-08, -0.0461001, -1.00473, 0, 0, 0, 0, -2.26807e-08, 0, 0, 0, 0, 0, 0, 0, 0, -4.44328e-09, 0, 0, 0, 0, -0.00751391, 0.00043629, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5.24183e-10, 0, 0, 0, 0, -1.22805e-12, 0, 0, 0, 0,
          0.0315899, 0.0150592, 1.72152e-08, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1.06363e-07, 1.00473, -0.0461001, 0, 0, 0, 0, -2.80511e-07, 0, 0, 0, 0, 0, 0, 0, 0, -6.72224e-08, 0, 0, 0, 0, 0.000436291, 0.00751391, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 7.75757e-10, 0, 0, 0, 0, -1.20098e-13, 0, 0, 0, 0,
          2.30823e-08, 1.94576e-07, -0.0152167, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.0629124, -3.00537e-07, 3.88919e-08, 0, 0, 0, 0, -0.977034, 0, 0, 0, 0, 0, 0, 0, 0, 0.342647, 0, 0, 0, 0, -8.71635e-10, -9.63927e-10, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -0.00220192, 0, 0, 0, 0, 3.12639e-06, 0, 0, 0, 0,
          2.95022e-08, 2.25204e-07, -0.0195205, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.0599409, -2.50753e-07, 3.04488e-08, 0, 0, 0, 0, -0.431928, 0, 0, 0, 0, 0, 0, 0, 0, -0.96518, 0, 0, 0, 0, 1.40033e-09, -1.88393e-09, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -0.00356163, 0, 0, 0, 0, -5.13176e-07, 0, 0, 0, 0,
          -0.0041274, -0.0190221, -2.99186e-09, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1.16143e-09, -0.00891636, 0.0126854, 0, 0, 0, 0, 1.66676e-09, 0, 0, 0, 0, 0, 0, 0, 0, -1.99593e-09, 0, 0, 0, 0, -0.756595, 0.658927, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 8.928e-10, 0, 0, 0, 0, -1.93277e-12, 0, 0, 0, 0,
          -0.0190221, 0.00412739, 6.66784e-10, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2.10013e-09, -0.0126854, -0.00891636, 0, 0, 0, 0, 1.11826e-09, 0, 0, 0, 0, 0, 0, 0, 0, 8.81185e-10, 0, 0, 0, 0, 0.658927, 0.756595, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -9.40323e-10, 0, 0, 0, 0, 4.09818e-12, 0, 0, 0, 0,
          1.39151e-09, -2.93159e-09, -0.00186585, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -0.00172187, 5.23203e-09, -2.04922e-09, 0, 0, 0, 0, 0.0073963, 0, 0, 0, 0, 0, 0, 0, 0, 0.00437884, 0, 0, 0, 0, -1.93084e-09, -1.46942e-10, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1.00058, 0, 0, 0, 0, -8.33747e-06, 0, 0, 0, 0,
          3.79798e-11, 2.86765e-12, -2.2744e-05, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -2.26032e-05, 6.26723e-12, -1.52196e-11, 0, 0, 0, 0, 2.42088e-05, 0, 0, 0, 0, 0, 0, 0, 0, -1.28404e-05, 0, 0, 0, 0, -2.43718e-11, -1.05947e-11, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -3.27565e-05, 0, 0, 0, 0, 1.00001, 0, 0, 0, 0;

  bool check_rpa_eigenvalues = rpa_eigenvalues_ref.isApprox(sol._Omega, 0.0001);
  if (!check_rpa_eigenvalues) {
    cout << "rpa_eigenvalues" << endl;
    cout << sol._Omega << endl;
    cout << "rpa_eigenvalues_ref" << endl;
    cout << rpa_eigenvalues_ref << endl;
  }
  BOOST_CHECK_EQUAL(check_rpa_eigenvalues, 1);

  bool check_rpa_XpY = rpa_XpY_ref.isApprox(sol._XpY, 0.0001);
  if (!check_rpa_XpY) {
    cout << "rpa_XpY" << endl;
    cout << sol._XpY << endl;
    cout << "rpa_XpY_ref" << endl;
    cout << rpa_XpY_ref << endl;
  }
  BOOST_CHECK_EQUAL(check_rpa_XpY, 1);

}

BOOST_AUTO_TEST_SUITE_END()
