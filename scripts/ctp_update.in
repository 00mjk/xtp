#! /usr/bin/env python
VERSION='@PROJECT_VERSION@ #CSG_HG_ID#'
import sys
import os
import getpass
import socket
import commands as cmds
import numpy as np
import xml.dom.minidom as xmld
import time
import argparse
import re
import math
import sqlite3

PROGTITLE = 'THE VOTCA::CTP STATE-FILE UPDATER'
VOTCAHEADER = '''\
==================================================
========   VOTCA (http://www.votca.org)   ========
==================================================

  o You can submit bugs to bugs@votca.org
  o ctp_testsuite, version {version}
                                                   
'''.format(version=VERSION)

# =============================================================================
# PROGRAM OPTIONS
# =============================================================================

class CtpHelpFormatter(argparse.HelpFormatter):
	def _format_usage(self, usage, action, group, prefix):
		return VOTCAHEADER
		
progargs = argparse.ArgumentParser(prog='ctp_testsuite',
    formatter_class=lambda prog: CtpHelpFormatter(prog,max_help_position=70),
	description=PROGTITLE)
	
progargs.add_argument('-f', '--file',
    dest='sqlfile',   
    action='store',
    required=True,
    type=str,
    help='State file to update.')
    
OPTIONS = progargs.parse_args()


# =============================================================================
# SQLITE3 EXECUTION
# =============================================================================

conn = sqlite3.connect(OPTIONS.sqlfile)
port = conn.cursor()

try:
	port.execute('ALTER TABLE pairs ADD COLUMN type INT;')
except:
	print "'pair' table already up-to-date"
	
try:
	port.execute('''CREATE TABLE superExchange 
           (_id INTEGER PRIMARY KEY AUTOINCREMENT,
            frame      INT NOT NULL,
            top        INT NOT NULL,
            type      TEXT NOT NULL)''')
except:
	print "'superExchange' table already up-to-date"

conn.commit()
conn.close()
sys.exit(0)

